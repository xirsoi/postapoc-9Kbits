namespace = faculty

# 300 - 350 Decision events
# 500 - 510 General events succes/failure
########################JOINING############################

#From on_character_ask_to_join_society
character_event = {
    id = faculty.100
	hide_window = yes
    is_triggered_only = yes
    trigger = {
    	FROM = { leader = { is_member_of_faculty_trigger = yes } }
    }
    immediate = {
    	FROM = { leader = { character_event = { id = faculty.101 } } } #target is the leader of the society
    }
}

#Ping event
character_event = {
    id = faculty.101
	hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = faculty.102 } } #send event back 
    }
}

#Welcome letter
letter_event = {
    id = faculty.102
    desc = EVTDESC_faculty_102
    border = GFX_event_letter_frame_war
	
    is_triggered_only = yes

	immediate = { set_character_flag = society_join_block }
	
    option = { #join the society
        name = EVTOPTA_faculty_102
		
		FROM = { ROOT = { join_prev_faculty_society = yes } }
		ai_chance = { factor = 10}
		# FROM = { society = { save_event_target_as = joining_society } }
        # join_society = event_target:joining_society
		clr_character_flag = society_join_block
	}
    option = { #don't
        name = EVTOPTB_faculty_102
		clr_character_flag = society_join_block
    }
}

########################AI JOIN AND AI RANK UP###########################

# Force join AI characters to societies
character_event = {
	id = faculty.200
	hide_window = yes
	
	# only_rulers = yes
	is_triggered_only = yes
	
	# has_dlc = "Mystics"
	
	immediate = {
		any_courtier = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = faculty.201 }
		}
		if = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
			}
			character_event = { id = faculty.201 }
		}
	}
}

character_event = {
	id = faculty.201
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				trigger = {
					can_join_society = university_yale
				}
				modifier = {
					factor = 3
					OR = {
						trait = scholar
						trait = theologian
						trait = gardener
						trait = architect
						trait = mystic
						learning = 16
					}
				}
				join_society = university_yale
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_mcgill
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						trait = gardener
						
						
						learning = 16
						
					}
				}
				join_society = university_mcgill
				random_list = { # Artificially increase society influence for balance purposes
					75 = {
						modifier = {
							factor = 0
						}
						modifier = {
							factor = 0
							society_influence >= 30
						}
						add_mission_succeed_influence_effect = yes
					}
					25 = {
					}
				}
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_UTS
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						trait = gardener
						
						
						learning = 16
						
					}
				}
				join_society = university_UTS
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_cleveland
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						trait = gardener
						
						
						learning = 16
						
					}
				}
				join_society = university_cleveland
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_atlanta
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						trait = gardener
						
						
						learning = 16
						
					}
				}
				join_society = university_atlanta
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_st_luis
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						learning = 16
						
					}
				}
				join_society = university_st_luis
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_west_indies
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						learning = 16
						
					}
				}
				join_society = university_west_indies
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
			100 = {
				trigger = {
					can_join_society = university_UCLA
				}
				modifier = {
					factor = 3
					OR = {
						trait = architect
						trait = scholar
						trait = theologian
						learning = 16
						
					}
				}
				join_society = university_UCLA
				
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}

	}
}


#######################Rank UP#############################

# Hidden start: Send the rank-up request to the current Grandmaster (delayed event on self, from decision to rank up)
character_event = {
	id = faculty.120

	hide_window = yes

	trigger = { #has pressed the button
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	immediate = {
		if = { #if he's still a member
			limit = { is_in_society = yes }
			random_society_member = { #will send the request to a random top rank member of the same society
				limit = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
				character_event = { id = faculty.121 } # send request to Grand Master.
			}
		}
		if = { #if he's not a member
			limit = { is_in_society = no }
			clr_character_flag = has_sent_request_to_rank_up
		}
	}
}

# Grandmaster gets the rank-up request
character_event = {
	id = faculty.121
	
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:rank_up_target = { letter_event = { id = faculty.122 } } #send it back
	}
}

#Grand master approves my request
letter_event = {
	id = faculty.122
	desc = EVTDESC_faculty_122
	border = GFX_event_letter_frame_war

	trigger = {
		society_rank < 4 #cannot rank up past 4
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	#Rank up approved
	option = {
		name = EVTOPTA_faculty_122
		if = { limit = { society_rank < 4 } #if not max rank, rank up
			society_rank_up = 1
		}
		clr_character_flag = has_sent_request_to_rank_up
	}
}

#################################MISSIONS######################################

#Mission tombola, this is where an hidden event choose a quest. I have made only one quest, do look for other mission tombola in the vanilla files for more example.
character_event = {
    id = faculty.130
    hide_window = yes

    is_triggered_only = yes
    
	is_in_society = yes

	trigger = {
		is_member_of_faculty_trigger = yes
		has_any_quest = no #cannot have more than 1 shown
		NOT = { has_character_modifier = quest_cooldown_timer } #to avoid spam and delay it for people who refused a quest.
		NOT = { is_inaccessible_trigger = yes }
		prisoner = no
		society = { #look if there is a close member to give you the quest
			any_society_member = {
				NOT = { character = ROOT }
				prisoner = no
				is_within_diplo_range = ROOT
				opinion = { who = ROOT value = 0 }
			}
		}
	}

    immediate = {
    	#Picks out mission giver
    	random_list = {
    		20 = { #International society member
    			society = {
    				random_society_member = {
    					limit = { 	
							NOT = { character = ROOT }
							prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
    					}
    					save_event_target_as = quest_collaborator
    				}
    			}
    		}
    		40 = { #Realm society member is there is any
    			trigger = {
    				society = {
    					any_society_member = {
    						NOT = { character = ROOT }
    						prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    				}
    			}
    			society = {
    				random_society_member = {
    					limit = { 	
    						NOT = { character = ROOT }
    						prisoner = no
    						is_within_diplo_range = ROOT
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    					save_event_target_as = quest_collaborator
    				}
    			}
    		}
    	}

    	#Randomizes mission
		#Has I have only 1 mission this random_list is unnecessary, but you will need it if you make more than one mission.
    	random_list = {
			150 = { #press the button, the mission
				event_target:quest_collaborator = { character_event = { id = faculty.140 days = 7 random = 7 } } #will send the quest to the quest_collaborator, which will offer it back to you.
			}			
						
			100 = { #AI refuse mission
				modifier = {
					factor = 0
					ai = no
				}
			}
    	}
    }
}

#This is the quest_collaborator receiving the mission and giving it back to you.
character_event = {
    id = faculty.140
    hide_window = yes #instant event, no need to show it
    is_triggered_only = yes
    immediate = { FROM = { society_quest_event = { id = faculty.141 days = 7 random = 7 } } }
}

#This event is set as a society_quest_event, not character_event. This is the accept or refuse the quest event, the next parts of the quest use the regular character_event.
society_quest_event = {
    id = faculty.141
    desc = EVTDESC_faculty_141

    is_triggered_only = yes
   
    option = { 
		name = ACCEPT
		
		set_quest = quest_faculty_quest_1 #use this if the quest has no real target, look at other quests made by Paradox if you want something more complicated that target someone/something
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = { #will delay the next quest for a while
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0.2 }
	}
}

#Funding quest
character_event = {
    id = faculty.142
    desc = EVTDESC_faculty_142
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war

    is_triggered_only = yes

    option = { 
        name = EVTOPTA_faculty_142
		FROM = {
			clr_quest = quest_faculty_quest_1 #remove the quest
			character_event = {
				id = faculty.501
			}		
		}
		clr_quest = quest_faculty_quest_1
		ai_chance = {
			factor = 0.01
			modifier = {
				factor = 10
				wealth = 500
			}
			modifier = {
				factor = 0.5
				OR = {
					trait = greedy
					trait = hedonist
					religion = gaian
					religion = pirate
				}
			}
			modifier = {
				factor = 50
				opinion = { who = ROOT value = 70 }
			}
			modifier = {
				factor = 150
				opinion = { who = ROOT value = 90 }
			}
		}
		wealth = -150
    }
    option = { 
        name = EVTOPTB_faculty_142
		FROM = {
			clr_quest = quest_faculty_quest_1 #remove the quest		
			character_event = {
				id = faculty.500
			}
		}
		clr_quest = quest_faculty_quest_1
		ai_chance = {
			factor = 0.8
		}
    }
}

# Students fighting
character_event = {
    id = faculty.150
    desc = EVTDESC_faculty_150
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war

    is_triggered_only = yes

	trigger = {
		is_member_of_faculty_trigger = yes		
	}
	
    option = {
        name = EVTOPTA_faculty_150
		trigger = {
			martial = 15			
		}
		random_list = {
			100 = {
				modifier = {
					factor = 10
					martial = 20
				}
			}
			100 = {
				modifier = {
					factor = 10
					trait = strong
				}
			}	
			100 = {
				modifier = {
					factor = 10
					OR = {
						martial = 15
						trait = weak
					}
				}
			}	
		}
	}
    option = {
        name = EVTOPTB_faculty_150
		trigger = {
			trait = arbitrary
		}
		random_list = {
			50 = {
				modifier = {
					factor = 10
					OR = {
						learning = 20
						trait = scholar
						society_rank >= 2
					}
					
				}
				prestige = 50
			}
				
			100 = {
				modifier = {
					factor = 10
					OR = {
						learning = 10
						trait = dwarf
						trait = stutter
						trait = lisp
					}
				}
				prestige = -50
			}	
		}

    }
	option = {
        name = EVTOPTC_faculty_150
		trigger = {
			diplomacy = 15
		}
		random_list = {
			100 = {
				modifier = {
					factor = 10
					OR = {
						diplomacy = 20
						trait = poet
					}
					
				}
				prestige = 50
			}				
			100 = {
				modifier = {
					factor = 10
					OR = {
						diplomacy = 10
						trait = stutter
						trait = lisp
					}
				}
				prestige = -50
			}	
		}
		
    }
    option = {
        name = EVTOPTD_faculty_150
		prestige = -50
		
    }
}


################################### Decisions #######################################

# Establish laboratory in capital
character_event = {
    id = faculty.300
    desc = EVTDESC_faculty_300
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war

    is_triggered_only = yes

	trigger = {
		is_member_of_faculty_trigger = yes
	}
	
    option = {
        name = EVTOPTA_faculty_300
		wealth = -100
		log = "[Root.GetBaseName] established laboratory in [Capital.GetBaseName]."
		capital_scope = {
			add_province_modifier = { name = laboratory_in_province duration = 3600 }
		}
    }
    option = {
        name = EVTOPTB_faculty_300
    }
}

# Choose academic discipline
character_event = {
    id = faculty.310
    desc = EVTDESC_faculty_310
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war

    is_triggered_only = yes

	trigger = {
		is_member_of_faculty_trigger = yes
	}
	
    option = {
        name = EVTOPTA_faculty_310
		trigger = {
			NOT = { trait = administrator }
		}
		add_trait = administrator
    }
    option = {
        name = EVTOPTB_faculty_310
		trigger = {
			NOT = { trait = scholar }
		}
		add_trait = scholar
    }
	 option = {
        name = EVTOPTC_faculty_310
		trigger = {
			NOT = { trait = physician }
		}
		add_trait = physician
    }
    option = {
        name = EVTOPTD_faculty_310
		trigger = {
			NOT = { trait = theologian }
		}
		add_trait = theologian
    }
}


# Disseminate technology
character_event = {
    id = faculty.320
    desc = EVTDESC_faculty_320
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war
	only_playable = yes
    is_triggered_only = yes

	trigger = {
		is_member_of_faculty_trigger = yes
	}
	
    option = {
        name = EVTOPTA_faculty_320
		wealth = -500
		log = "Disseminated technology in [From.Realm.GetBaseName]."
		any_vassal = {			
			character_event = { id = faculty.321 }		
		}
    }
    option = {
        name = EVTOPTB_faculty_320
    }
}

# Characters get techpoints
character_event = {
	id = faculty.321
	desc = EVTDESC_faculty_321
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_war
	only_playable = yes
	
	is_triggered_only = yes
	immediate = {
		log = "[Root.GetBestName] got new technology."
		economy_techpoints = 200
		military_techpoints = 200
		culture_techpoints = 200
	}
	option = {
		name = EVTOPTA_faculty_321
	}
}

# General quest failure 
character_event = {
	id = faculty.500
	hide_window = yes
	immediate = {
		add_mission_fail_influence_effect = yes #quest remove society influence
		change_society_currency = -100 #penalty
		log = "[Root.GetBaseName] failed in university mission."	
	}
}

# General quest success 
character_event = {
	id = faculty.501
	hide_window = yes
	immediate = {
		add_mission_succeed_influence_effect = yes #quest add society influence
		change_society_currency = 100 #reward
		log = "[Root.GetBaseName] suceeded in university mission."
	}
}
